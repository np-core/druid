FROM continuumio/miniconda3

ARG MINICONDA_VERSION=latest

ENV PATH /opt/conda/bin:$PATH
RUN rm /bin/sh && ln -s /bin/bash /bin/sh

ENV TAXDUMP /NCBI_tax
ENV BLASTDB /NCBI_nt

RUN apt-get update && apt-get install -y wget git

RUN conda install -c conda-forge -c bioconda -c ursky metawrap-mg=1.3.2

RUN mkdir -p /db/checkm && cd /db/checkm && wget https://data.ace.uq.edu.au/public/CheckM_databases/checkm_data_2015_01_16.tar.gz && tar -xvf *.tar.gz && rm *.gz

RUN checkm_db="/db/checkm" && echo ${checkm_db} | checkm data setRoot ${checkm_db}

RUN git clone -b v0.1.0 https://github.com/np-core/druid && pip install druid/

RUN mkdir /NCBI_tax && cd /NCBI_tax && wget ftp://ftp.ncbi.nlm.nih.gov/pub/taxonomy/taxdump.tar.gz && tar -xvf taxdump.tar.gz